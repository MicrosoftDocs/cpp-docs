---
description: "Learn more about: CDebugReportHook Class"
title: "CDebugReportHook Class"
ms.date: "11/04/2016"
f1_keywords: ["CDebugReportHook", "ATLUTIL/ATL::CDebugReportHook", "ATLUTIL/ATL::CDebugReportHook::CDebugReportHook", "ATLUTIL/ATL::CDebugReportHook::CDebugReportHookProc", "ATLUTIL/ATL::CDebugReportHook::RemoveHook", "ATLUTIL/ATL::CDebugReportHook::SetHook", "ATLUTIL/ATL::CDebugReportHook::SetPipeName", "ATLUTIL/ATL::CDebugReportHook::SetTimeout"]
helpviewer_keywords: ["CDebugReportHook class"]
ms.assetid: 798076c3-6e63-4286-83b8-aa1bbcd0c20c
---
# CDebugReportHook Class

Use this class to send debug reports to a named pipe.

## Syntax

```
class CDebugReportHook
```

## Members

### Public Constructors

|Name|Description|
|----------|-----------------|
|[CDebugReportHook::CDebugReportHook](#cdebugreporthook)|Calls [SetPipeName](#setpipename), [SetTimeout](#settimeout), and [SetHook](#sethook).|
|[CDebugReportHook::~CDebugReportHook](#dtor)|Calls [CDebugReportHook::RemoveHook](#removehook).|

### Public Methods

|Name|Description|
|----------|-----------------|
|[CDebugReportHook::CDebugReportHookProc](#cdebugreporthookproc)|(Static) The custom reporting function that is hooked into the C run-time debug reporting process.|
|[CDebugReportHook::RemoveHook](#removehook)|Call this method to stop sending debug reports to the named pipe and restore the previous report hook.|
|[CDebugReportHook::SetHook](#sethook)|Call this method to start sending debug reports to the named pipe.|
|[CDebugReportHook::SetPipeName](#setpipename)|Call this method to set the machine and name of the pipe to which the debug reports will be sent.|
|[CDebugReportHook::SetTimeout](#settimeout)|Call this method to set the time in milliseconds that this class will wait for the named pipe to become available.|

## Remarks

Create an instance of this class in debug builds of your services or applications to send debug reports to a named pipe. Debug reports are generated by calling [_CrtDbgReport](../../c-runtime-library/reference/crtdbgreport-crtdbgreportw.md) or using a wrapper for this function such as the [ATLTRACE](debugging-and-error-reporting-macros.md#atltrace) and [ATLASSERT](debugging-and-error-reporting-macros.md#atlassert) macros.

Use of this class allows you to interactively debug components running in non-interactive [window stations](/windows/win32/winstation/window-stations).

Note that debug reports are sent using the underlying security context of the thread. Impersonation is temporarily disabled so that debug reports can be viewed in situations where impersonation of low privilege users is taking place, such as in web applications.

## Requirements

**Header:** atlutil.h

## <a name="cdebugreporthook"></a> CDebugReportHook::CDebugReportHook

Calls [SetPipeName](#setpipename), [SetTimeout](#settimeout), and [SetHook](#sethook).

```
CDebugReportHook(
    LPCSTR szMachineName = ".",
    LPCSTR szPipeName = "AtlsDbgPipe",
    DWORD dwTimeout = 20000) throw();
```

### Parameters

*szMachineName*<br/>
The name of the machine to which the debug output should be sent. Defaults to the local machine.

*szPipeName*<br/>
The name of the named pipe to which the debug output should be sent.

*dwTimeout*<br/>
The time in milliseconds that this class will wait for the named pipe to become available.

## <a name="dtor"></a> CDebugReportHook::~CDebugReportHook

Calls [CDebugReportHook::RemoveHook](#removehook).

```
~CDebugReportHook() throw();
```

## <a name="cdebugreporthookproc"></a> CDebugReportHook::CDebugReportHookProc

The custom reporting function that is hooked into the C run-time debug reporting process.

```
static int __cdecl CDebugReportHookProc(
    int reportType,
    char* message,
    int* returnValue) throw();
```

### Parameters

*reportType*<br/>
The type of the report (_CRT_WARN, _CRT_ERROR, or _CRT_ASSERT).

*message*<br/>
The message string.

*returnValue*<br/>
The value that should be returned by [_CrtDbgReport](../../c-runtime-library/reference/crtdbgreport-crtdbgreportw.md).

### Return Value

Returns FALSE if the hook handles the message in question completely so that no further reporting is required. Returns TRUE if `_CrtDbgReport` should report the message in the normal way.

### Remarks

The reporting function attempts to open the named pipe and communicate with the process at the other end. If the pipe is busy, the reporting function will wait until the pipe is free or the timeout expires. The timeout can be set by the constructor or a call to [CDebugReportHook::SetTimeout](#settimeout).

The code in this function is executed in the underlying security context of the calling thread, that is, impersonation is disabled for the duration of this function.

## <a name="removehook"></a> CDebugReportHook::RemoveHook

Call this method to stop sending debug reports to the named pipe and restore the previous report hook.

```cpp
void RemoveHook() throw();
```

### Remarks

Calls [_CrtSetReportHook2](../../c-runtime-library/reference/crtsetreporthook2-crtsetreporthookw2.md) to restore the previous report hook.

## <a name="sethook"></a> CDebugReportHook::SetHook

Call this method to start sending debug reports to the named pipe.

```cpp
void SetHook() throw();
```

### Remarks

Calls [_CrtSetReportHook2](../../c-runtime-library/reference/crtsetreporthook2-crtsetreporthookw2.md) to have debug reports routed through [CDebugReportHookProc](#cdebugreporthookproc) to the named pipe. This class keeps track of the previous report hook so that it can be restored when [RemoveHook](#removehook) is called.

## <a name="setpipename"></a> CDebugReportHook::SetPipeName

Call this method to set the machine and name of the pipe to which the debug reports will be sent.

```
BOOL SetPipeName(
    LPCSTR szMachineName = ".",
    LPCSTR szPipeName = "AtlsDbgPipe") throw();
```

### Parameters

*szMachineName*<br/>
The name of the machine to which the debug output should be sent.

*szPipeName*<br/>
The name of the named pipe to which the debug output should be sent.

### Return Value

Returns TRUE on success, FALSE on failure.

## <a name="settimeout"></a> CDebugReportHook::SetTimeout

Call this method to set the time in milliseconds that this class will wait for the named pipe to become available.

```cpp
void SetTimeout(DWORD dwTimeout);
```

### Parameters

*dwTimeout*<br/>
The time in milliseconds that this class will wait for the named pipe to become available.

## See also

[Classes](../../atl/reference/atl-classes.md)
